# =================================================
# PRICE HISTORY
# =================================================

<PriceHistoryRow@BoxLayout>:
    # ðŸ”‘ REQUIRED PROPERTIES (THIS FIXES THE CRASH)
    item: ""
    old_price: ""
    new_price: ""
    date: ""

    orientation: "vertical"
    size_hint_y: None
    height: dp(130)
    padding: dp(14)
    spacing: dp(6)

    canvas.before:
        Color:
            rgba: 0.25, 0.18, 0.1, 0.8
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [12]

    Label:
        text: root.item
        font_size: "16sp"
        bold: True
        color: 1, 1, 1, 1
        size_hint_y: None
        height: dp(26)
        halign: "left"
        valign: "middle"
        text_size: self.size

    Label:
        text: "Old Price: " + root.old_price
        size_hint_y: None
        height: dp(22)
        halign: "left"
        valign: "middle"
        text_size: self.size

    Label:
        text: "New Price: " + root.new_price
        size_hint_y: None
        height: dp(22)
        halign: "left"
        valign: "middle"
        text_size: self.size

    Label:
        text: "Last Changed: " + root.date
        font_size: "12sp"
        size_hint_y: None
        height: dp(20)
        halign: "left"
        valign: "middle"
        text_size: self.size


<PriceHistoryScreen>:
    BackgroundLayout:
        padding: dp(20)
        spacing: dp(16)

        Label:
            text: "Inventory Price History"
            font_size: 22
            color: 1, 1, 1, 1
            size_hint_y: None
            height: dp(40)

        BoxLayout:
            size_hint_y: None
            height: dp(48)
            spacing: dp(12)

            StyledSpinner:
                id: shop
                text: "Select Shop"
                values: root.shops
                size_hint_x: 0.6
                height: dp(44)
                on_text: root.load_items(self.text)

            StyledSpinner:
                id: item
                text: "Select Item"
                values: root.items
                size_hint_x: 0.4
                height: dp(44)
                on_text: root.load_history(self.text)

        Label:
            text: "Select a shop and item to view price history"
            color: 1, 1, 1, 0.7
            size_hint_y: None
            height: dp(28)
            halign: "center"
            valign: "middle"
            text_size: self.size

        RecycleView:
            id: history_rv
            viewclass: "PriceHistoryRow"
            data: root.rv_data
            size_hint_y: 1

            RecycleBoxLayout:
                orientation: "vertical"
                default_size: None, dp(140)
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(12)

        StyledButton:
            text: "Back"
            size_hint_y: None
            height: dp(44)
            on_release: app.root.current = "inventory"
